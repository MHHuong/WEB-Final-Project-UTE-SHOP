<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/user-layout.html}" lang="en">

<main layout:fragment="content">
    <section class="mt-8 mb-8">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8 col-md-10">
                    <!-- Order Status Timeline -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body text-center py-5">
                            <div th:replace="~{fragments/user/order/status::order-timeline}"></div>
                            <div class="d-flex justify-content-center align-items-center gap-2 mb-4">
                                <span class="text-muted">Mã đơn hàng:</span>
                                <strong class="text-primary fs-5" id="order-code">Đang tải...</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Order Details -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-light border-0 py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-receipt text-primary me-2"></i>
                                Chi Tiết Đơn Hàng
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Order Items -->
                            <div id="order-items-container" class="mb-3">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Đang tải...</span>
                                    </div>
                                </div>
                            </div>

                            <hr>

                            <!-- Order Summary -->
                            <div class="order-summary">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Tạm tính:</span>
                                    <span id="subtotal-amount">0₫</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Phí vận chuyển:</span>
                                    <span id="shipping-amount">0₫</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Giảm giá:</span>
                                    <span class="text-danger" id="discount-amount">-0₫</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between mb-0">
                                    <h5 class="mb-0">Tổng cộng:</h5>
                                    <h5 class="mb-0 text-primary" id="total-amount">0₫</h5>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shipping & Payment Info -->
                    <div class="row g-3 mb-4">
                        <!-- Shipping Info -->
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-light border-0 py-3">
                                    <h6 class="mb-0">
                                        <i class="bi bi-truck text-primary me-2"></i>
                                        Thông Tin Giao Hàng
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <small class="text-muted">Người nhận:</small>
                                        <p class="mb-1 fw-medium" id="receiver-name">Đang tải...</p>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Số điện thoại:</small>
                                        <p class="mb-1" id="receiver-phone">Đang tải...</p>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Địa chỉ:</small>
                                        <p class="mb-1" id="shipping-address">Đang tải...</p>
                                    </div>
                                    <div>
                                        <small class="text-muted">Phương thức vận chuyển:</small>
                                        <p class="mb-0" id="shipping-method">Đang tải...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Info -->
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-light border-0 py-3">
                                    <h6 class="mb-0">
                                        <i class="bi bi-credit-card text-primary me-2"></i>
                                        Thông Tin Thanh Toán
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <small class="text-muted">Phương thức thanh toán:</small>
                                        <p class="mb-1 fw-medium" id="payment-method">Đang tải...</p>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Trạng thái thanh toán:</small>
                                        <p class="mb-1">
                                            <span class="badge bg-warning" id="payment-status">Chưa thanh toán</span>
                                        </p>
                                    </div>
                                    <div>
                                        <small class="text-muted">Thời gian đặt hàng:</small>
                                        <p class="mb-0" id="order-time">Đang tải...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="card border-0 shadow-sm" id="action-buttons-card">
                        <div class="card-body text-center py-4">
                            <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center" id="order-actions">
                                <!-- Actions will be rendered based on order status -->
                                <a href="/user/profile" class="btn btn-outline-primary btn-lg px-5">
                                    <i class="bi bi-list-ul me-2"></i>
                                    Xem Đơn Hàng Của Tôi
                                </a>
                                <a href="/" class="btn btn-outline-secondary btn-lg px-5">
                                    <i class="bi bi-house me-2"></i>
                                    Tiếp Tục Mua Sắm
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Info -->
                    <div class="alert alert-info mt-4 mb-0" id="info-alert">
                        <div class="d-flex">
                            <i class="bi bi-info-circle me-3 fs-4"></i>
                            <div>
                                <h6 class="alert-heading mb-2">Lưu ý quan trọng</h6>
                                <ul class="mb-0 small ps-3" id="info-list">
                                    <li>Bạn có thể theo dõi trạng thái đơn hàng trên trang này.</li>
                                    <li>Vui lòng kiểm tra thông tin đơn hàng và liên hệ với chúng tôi nếu có bất kỳ thắc mắc nào.</li>
                                    <li>Đơn hàng sẽ được giao trong thời gian dự kiến theo phương thức vận chuyển bạn đã chọn.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div th:replace="~{fragments/user/modal::status-modal}"></div>

    <style>
    .order-item {
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
    }

    .order-item:last-child {
        border-bottom: none;
    }

    .product-img-success {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
    }

    @media (max-width: 576px) {
        .product-img-success {
            width: 60px;
            height: 60px;
        }
    }

    /* Action buttons specific styles */
    #order-actions .btn-cancel-order {
        background-color: #dc3545;
        border-color: #dc3545;
        color: white;
    }

    #order-actions .btn-cancel-order:hover {
        background-color: #c82333;
        border-color: #bd2130;
    }

    #order-actions .btn-confirm-received {
        background-color: #0aad0a;
        border-color: #0aad0a;
        color: white;
    }

    #order-actions .btn-confirm-received:hover {
        background-color: #098d08;
        border-color: #087d07;
    }
</style>

<!-- Order Detail Page JavaScript -->
<script type="module" src="/js/services/orderDetailService.js"></script>

</main>
</html>

