<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{user/user-layout.html}" lang="en">

<main layout:fragment="content">
    <section class="mt-8 mb-8">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8 col-md-10">
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-body text-center py-5">
                            <div th:replace="~{fragments/user/order/status::success}"></div>
                            <div th:replace="~{fragments/user/order/status::pending}"></div>
                            <div th:replace="~{fragments/user/order/status::failed}"></div>
                            <div th:replace="~{fragments/user/order/status::order-timeline}"></div>
                            <div class="d-flex justify-content-center align-items-center gap-2 mb-4">
                                <span class="text-muted">Order Id:</span>
                                <strong class="text-primary fs-5" id="order-code">Loading...</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Order Details -->
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-light border-0 py-3">
                            <h5 class="mb-0">
                                <i class="bi bi-receipt text-primary me-2"></i>
                                Order Details
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Order Items -->
                            <div id="order-items-container" class="mb-3">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>

                            <hr>

                            <!-- Order Summary -->
                            <div class="order-summary">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Subtotal: </span>
                                    <span id="subtotal-amount">0₫</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Delivery Cost:</span>
                                    <span id="shipping-amount">0₫</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Discount:</span>
                                    <span class="text-danger" id="discount-amount">-0₫</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between mb-0">
                                    <h5 class="mb-0">Total:</h5>
                                    <h5 class="mb-0 text-primary" id="total-amount">0₫</h5>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shipping & Payment Info -->
                    <div class="row g-3 mb-4">
                        <!-- Shipping Info -->
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-light border-0 py-3">
                                    <h6 class="mb-0">
                                        <i class="bi bi-truck text-primary me-2"></i>
                                        Delivery Information
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <small class="text-muted">Receiver's Name:</small>
                                        <p class="mb-1 fw-medium" id="receiver-name">Loading...</p>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Phone Number:</small>
                                        <p class="mb-1" id="receiver-phone">Loading...</p>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Address:</small>
                                        <p class="mb-1" id="shipping-address">Loading...</p>
                                    </div>
                                    <div>
                                        <small class="text-muted">Shipping Method:</small>
                                        <p class="mb-0" id="shipping-method">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Info -->
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-header bg-light border-0 py-3">
                                    <h6 class="mb-0">
                                        <i class="bi bi-credit-card text-primary me-2"></i>
                                        Payment Information
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-2">
                                        <small class="text-muted">Paying Method:</small>
                                        <p class="mb-1 fw-medium" id="payment-method">Loading...</p>
                                    </div>
                                    <div class="mb-2">
                                        <small class="text-muted">Paying status:</small>
                                        <p class="mb-1">
                                            <span class="badge bg-warning" id="payment-status">Haven't Paid Yet</span>
                                        </p>
                                    </div>
                                    <div>
                                        <small class="text-muted">Order Time:</small>
                                        <p class="mb-0" id="order-time">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="card border-0 shadow-sm" id="action-buttons-card">
                        <div class="card-body text-center py-4">
                            <div class="d-flex flex-column flex-sm-row gap-3 justify-content-center" id="order-actions">
                                <a th:href="@{/user/profile}" class="btn btn-primary btn-lg px-5">
                                    <i class="bi bi-list-ul me-2"></i>
                                    Watch Order History
                                </a>
                                <a th:href="@{/user}" class="btn btn-outline-primary btn-lg px-5">
                                    <i class="bi bi-house me-2"></i>
                                    Continue Shopping
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Info -->
                    <div class="alert alert-info mt-4 mb-0" id="info-alert">
                        <div class="d-flex">
                            <i class="bi bi-info-circle me-3 fs-4"></i>
                            <div>
                                <h6 class="alert-heading mb-2">Important Information</h6>
                                <ul class="mb-0 small ps-3" id="info-list">
                                    <li>You’ll receive an order confirmation email shortly.</li>
                                    <li>Please check your order details and contact us if you have any questions.</li>
                                    <li>Your order will be delivered within the estimated timeframe based on your chosen shipping method.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div th:replace="~{fragments/user/modal::status-modal}"></div>
    </section>


<style>
    .success-checkmark {
        width: 80px;
        height: 80px;
        margin: 0 auto;
    }

    .success-checkmark .check-icon {
        width: 80px;
        height: 80px;
        position: relative;
        border-radius: 50%;
        box-sizing: content-box;
        border: 4px solid #198754;
    }

    .success-checkmark .check-icon::before {
        top: 3px;
        left: -2px;
        width: 30px;
        transform-origin: 100% 50%;
        border-radius: 100px 0 0 100px;
    }

    .success-checkmark .check-icon::after {
        top: 0;
        left: 30px;
        width: 60px;
        transform-origin: 0 50%;
        border-radius: 0 100px 100px 0;
        animation: rotate-circle 4.25s ease-in;
    }

    .success-checkmark .check-icon::before, .success-checkmark .check-icon::after {
        content: '';
        height: 100px;
        position: absolute;
        background: #ffffff;
        transform: rotate(-45deg);
    }

    .success-checkmark .check-icon .icon-line {
        height: 5px;
        background-color: #198754;
        display: block;
        border-radius: 2px;
        position: absolute;
        z-index: 10;
    }

    .success-checkmark .check-icon .icon-line.line-tip {
        top: 46px;
        left: 14px;
        width: 25px;
        transform: rotate(45deg);
        animation: icon-line-tip 0.75s;
    }

    .success-checkmark .check-icon .icon-line.line-long {
        top: 38px;
        right: 8px;
        width: 47px;
        transform: rotate(-45deg);
        animation: icon-line-long 0.75s;
    }

    .success-checkmark .check-icon .icon-circle {
        top: -4px;
        left: -4px;
        z-index: 10;
        width: 80px;
        height: 80px;
        border-radius: 50%;
        position: absolute;
        box-sizing: content-box;
        border: 4px solid rgba(25, 135, 84, .5);
    }

    .success-checkmark .check-icon .icon-fix {
        top: 8px;
        width: 5px;
        left: 26px;
        z-index: 1;
        height: 85px;
        position: absolute;
        transform: rotate(-45deg);
        background-color: #ffffff;
    }

    .icon-circle::before {
        content: '';
    }

    .order-item {
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
    }

    .order-item:last-child {
        border-bottom: none;
    }

    .product-img-success {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
    }

    @media (max-width: 576px) {
        .product-img-success {
            width: 60px;
            height: 60px;
        }
    }

    /* Action buttons specific styles */
    #order-actions .btn-cancel-order {
        background-color: #dc3545;
        border-color: #dc3545;
        color: white;
    }

    #order-actions .btn-cancel-order:hover {
        background-color: #c82333;
        border-color: #bd2130;
    }

    #order-actions .btn-confirm-received {
        background-color: #0aad0a;
        border-color: #0aad0a;
        color: white;
    }

    #order-actions .btn-confirm-received:hover {
        background-color: #098d08;
        border-color: #087d07;
    }

    @keyframes rotate-circle {
        0% {
            transform: rotate(-45deg);
        }
        5% {
            transform: rotate(-45deg);
        }
        12% {
            transform: rotate(-405deg);
        }
        100% {
            transform: rotate(-405deg);
        }
    }

    @keyframes icon-line-tip {
        0% {
            width: 0;
            left: 1px;
            top: 19px;
        }
        54% {
            width: 0;
            left: 1px;
            top: 19px;
        }
        70% {
            width: 50px;
            left: -8px;
            top: 37px;
        }
        84% {
            width: 17px;
            left: 21px;
            top: 48px;
        }
        100% {
            width: 25px;
            left: 14px;
            top: 45px;
        }
    }

    @keyframes icon-line-long {
        0% {
            width: 0;
            right: 46px;
            top: 54px;
        }
        65% {
            width: 0;
            right: 46px;
            top: 54px;
        }
        84% {
            width: 55px;
            right: 0px;
            top: 35px;
        }
        100% {
            width: 47px;
            right: 8px;
            top: 38px;
        }
    }

    /* Pending payment icon */
    .pending-icon i {
        font-size: 80px;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.5;
        }
    }

    /* Failed payment icon */
    .failed-icon i {
        font-size: 80px;
        animation: shake 0.5s;
    }

    @keyframes shake {
        0%, 100% {
            transform: translateX(0);
        }
        25% {
            transform: translateX(-10px);
        }
        75% {
            transform: translateX(10px);
        }
    }

    /* Countdown timer */
    .countdown-timer {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .timer-box {
        padding: 20px 40px;
    }

    .timer-text {
        font-size: 48px;
        font-weight: bold;
        color: #0aad0a;
    }

    .timer-box small {
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
    }

    /* Timer warning state */
    .timer-box small.warning {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    /* Responsive timer */
    @media (max-width: 576px) {
        .timer-text {
            font-size: 36px;
        }

        .timer-box {
            padding: 15px 30px;
        }
    }

    .order-item {
        padding: 1rem;
        border-bottom: 1px solid #dee2e6;
    }

    .order-item:last-child {
        border-bottom: none;
    }

    .product-img-success {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
    }

    @media (max-width: 576px) {
        .product-img-success {
            width: 60px;
            height: 60px;
        }
    }
</style>

    <script th:src="@{/js/vendors/jquery.min.js}"></script>
    <script th:src="@{/libs/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/libs/simplebar/dist/simplebar.min.js}"></script>
<script type="module" th:src="@{/js/services/view/showResultService.js}"></script>
<script type="module" th:src="@{/js/services/view/orderDetailService.js}"></script>

</main>
</html>
