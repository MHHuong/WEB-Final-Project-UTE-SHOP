<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<body>

<div th:fragment="product-card(product)" class="card card-product h-100">
    <div class="card-body">
        <div class="text-center position-relative">
            <a th:href="@{/products/{id}(id=${product.productId})}">
                <img th:src="${!product.media.isEmpty() ? product.media.iterator().next().url : '/assets/images/products/product-img-default.jpg'}"
                     alt="Product Image" class="mb-3 img-fluid"
                     style="height: 180px; object-fit: cover;" />
            </a>

            <div class="card-product-action">
                <a href="#!" class="btn-action" data-bs-toggle="modal" data-bs-target="#quickViewModal">
                    <i class="bi bi-eye" data-bs-toggle="tooltip" data-bs-html="true" title="Quick View"></i>
                </a>
                <a href="#!" class="btn-action" data-bs-toggle="tooltip" data-bs-html="true" title="Wishlist"><i
                        class="bi bi-heart"></i></a>

            </div>
        </div>

        <div class="text-small mb-1">
            <a th:href="@{/categories/{id}(id=${product.category?.categoryId})}" class="text-decoration-none text-muted">
                <small th:text="${product.category?.name}">Category</small>
            </a>
        </div>

        <h2 class="fs-6">
            <a th:href="@{/products/{id}(id=${product.productId})}" class="text-inherit text-decoration-none"
               th:text="${product.name}">Product Name</a>
        </h2>

        <div>
            <th:block
                    th:with="avgRating=${!product.reviews.isEmpty() ? #aggregates.avg(product.reviews.![rating]) : 0}, reviewCount=${#lists.size(product.reviews)}">
                <small class="text-warning">
                    <i class="bi bi-star-fill"></i>
                    <span th:text="${#numbers.formatDecimal(avgRating, 1, 1)}">4.5</span>
                </small>
                <span class="text-muted small" th:text="${'(' + reviewCount + ')'}">(149)</span>
            </th:block>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-3">
            <div>
                <span class="text-dark fw-bold" th:text="${#numbers.formatInteger(product.price, 1, 'POINT')} + 'đ'">1.000.000đ</span>
            </div>
            <div>
                <a th:href="@{/cart/add(productId=${product.productId})}" class="btn btn-primary btn-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                         class="feather feather-plus">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add
                </a>
            </div>
        </div>
    </div>
</div>

</body>
</html>